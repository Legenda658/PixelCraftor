# PixelCraftor - Редактор пиксельной графики

## Содержание
- [Введение](#введение)
- [Структура проекта](#структура-проекта)
- [Архитектура](#архитектура)
- [Используемые библиотеки](#используемые-библиотеки)
- [Описание файлов](#описание-файлов)
- [Точка входа](#точка-входа)
- [Ключевые архитектурные решения](#ключевые-архитектурные-решения)
- [Инструменты редактора](#инструменты-редактора)
- [Горячие клавиши](#горячие-клавиши)
- [Последние улучшения](#последние-улучшения)
- [Рекомендации по разработке](#рекомендации-по-разработке)
- [Установка и запуск](#установка-и-запуск)
- [Планы развития](#планы-развития)

## Введение

PixelCraftor - это редактор пиксельной графики, разработанный с использованием PySide6 (Qt для Python). Приложение позволяет создавать и редактировать пиксельные изображения с различными инструментами, поддержкой слоев, историей изменений и возможностью экспорта в различные форматы.

Основные возможности:
- Пиксельный холст с настраиваемым разрешением
- Набор инструментов для рисования (карандаш, ластик, заливка и др.)
- Система слоев
- История изменений с возможностью отмены/повтора
- Линейки и направляющие
- Трансформация выделенных областей
- Поддержка различных форматов файлов
- Настраиваемая сетка
- Экспорт в XBM формат (для использования в микроконтроллерах)
- Поддержка тем оформления (светлая/темная)
- Многоязычный интерфейс (русский/английский)

## Структура проекта

```
PixelCraftor/
│
├── main.py                # Точка входа в приложение
├── canvas.py              # Основной класс холста для рисования
├── tools.py               # Инструменты рисования и панель инструментов
├── layers.py              # Система слоев
├── history.py             # Система истории изменений
├── settings.py            # Управление настройками приложения
├── settings.json          # Файл с настройками
├── themes.py              # Управление темами оформления
├── localization.py        # Система локализации
├── shortcuts.py           # Управление горячими клавишами
├── resolution_dialog.py   # Диалог выбора разрешения
├── resolution_widget.py   # Виджет отображения текущего разрешения
├── xbm_converter.py       # Конвертер в формат XBM
├── PixelCraftor.ico       # Иконка приложения
├── PROJECT_OVERVIEW.md    # Документация проекта
└── __pycache__/           # Кэш Python
```

## Архитектура

PixelCraftor построен на основе архитектуры Model-View-Controller (MVC) с использованием компонентов Qt:

- **Model**: Классы для управления данными (canvas.py, layers.py, history.py)
- **View**: Пользовательский интерфейс (main.py, resolution_dialog.py, resolution_widget.py)
- **Controller**: Обработка пользовательских действий (tools.py, shortcuts.py)

Приложение имеет модульную структуру, где каждый компонент отвечает за свою функциональность и взаимодействует с другими через сигналы и слоты Qt.

## Используемые библиотеки

1. **PySide6** - Qt для Python, используется для создания графического интерфейса
   - `QtWidgets` - виджеты пользовательского интерфейса
   - `QtGui` - компоненты для работы с графикой
   - `QtCore` - базовые классы Qt

2. **PIL (Python Imaging Library)** - используется для работы с изображениями, особенно для форматов, не поддерживаемых напрямую Qt

3. **Стандартные библиотеки Python**:
   - `sys` - для взаимодействия с системой
   - `os` - для работы с файловой системой
   - `json` - для работы с настройками
   - `re` - для парсинга XBM формата

## Описание файлов

### main.py
Основной файл приложения, содержащий класс `PixelCraftor`, который является главным окном приложения. Отвечает за:
- Инициализацию всех компонентов
- Создание меню и панелей инструментов
- Обработку файловых операций
- Настройку горячих клавиш
- Управление основным интерфейсом

Взаимодействует со всеми остальными модулями, выступая в роли координатора.

### canvas.py
Содержит класс `PixelCanvas`, который является центральным элементом приложения - холстом для рисования. Отвечает за:
- Отображение и редактирование изображения
- Обработку инструментов рисования
- Управление выделением
- Трансформацию выделенных областей
- Отображение сетки, линеек и направляющих
- Сохранение состояний для истории изменений

Взаимодействует с `tools.py` для получения активного инструмента и цвета, с `history.py` для сохранения состояний.

### tools.py
Содержит классы для управления инструментами рисования:
- `ToolPanel` - панель инструментов
- `ToolButton` - кнопка инструмента
- `ColorPalette` - палитра цветов
- `ColorButton` - кнопка выбора цвета

Отвечает за выбор инструментов и цветов, которые затем используются в `canvas.py`.

### layers.py
Реализует систему слоев:
- `LayerManager` - управление слоями
- `LayerWidget` - пользовательский интерфейс для работы со слоями
- `LayerItem` - представление отдельного слоя в интерфейсе

Позволяет создавать, удалять и перемещать слои, а также управлять их видимостью.

### history.py
Реализует систему истории изменений:
- `HistoryManager` - управление историей
- `HistoryWidget` - интерфейс для просмотра истории
- `HistoryThumbnail` - миниатюра состояния в истории

Обеспечивает функциональность отмены/повтора действий.

### settings.py
Класс `Settings` для управления настройками приложения:
- Загрузка/сохранение настроек из JSON
- Доступ к настройкам
- Управление списком недавно открытых файлов

### themes.py
Класс `ThemeManager` для управления темами оформления:
- Переключение между светлой и темной темами
- Настройка цветовой палитры интерфейса

### localization.py
Класс `LocalizationManager` для многоязычной поддержки:
- Переключение между языками
- Перевод интерфейса
- Хранение строк на разных языках

### shortcuts.py
Содержит:
- `ShortcutManager` - управление горячими клавишами
- `ShortcutList` - отображение списка горячих клавиш

### resolution_dialog.py
Диалог `ResolutionDialog` для выбора разрешения холста:
- Ручной ввод размеров
- Выбор из предустановленных разрешений

### resolution_widget.py
Виджет `ResolutionWidget` для отображения и изменения текущего разрешения холста.

### xbm_converter.py
Класс `XBMConverter` для конвертации между QImage и XBM форматом:
- Экспорт изображения в XBM формат
- Импорт XBM в изображение

### settings.json
Файл с настройками приложения в формате JSON:
- Тема оформления
- Язык интерфейса
- Настройки отображения сетки
- Размеры холста по умолчанию
- Настройки автосохранения

## Точка входа

Точкой входа в приложение является функция `main()` в файле `main.py`. Она создает экземпляр приложения Qt, инициализирует главное окно `PixelCraftor` и запускает цикл обработки событий.

```python
def main():
    app = QApplication(sys.argv)
    app.setWindowIcon(QIcon("PixelCraftor.ico"))
    window = PixelCraftor()
    window.show()
    sys.exit(app.exec())

if __name__ == "__main__":
    main()
```

## Ключевые архитектурные решения

### Система сигналов и слотов
Для взаимодействия между компонентами используется система сигналов и слотов Qt, что позволяет создать слабосвязанную архитектуру:
- `canvas_changed` - сигнал об изменении холста
- `tool_changed` - сигнал о смене инструмента
- `color_changed` - сигнал о смене цвета
- `layer_added`, `layer_removed`, `layer_moved` - сигналы о изменениях в слоях
- `resolution_changed` - сигнал об изменении разрешения

### Модульная структура
Каждый компонент выделен в отдельный модуль, что улучшает поддерживаемость и расширяемость:
- Инструменты рисования можно легко добавлять
- Поддержка новых форматов файлов реализуется отдельными конвертерами
- Система тем и локализации независимы от основного кода

### Система истории изменений
Реализована с помощью снимков состояния (snapshots):
- Каждое изменение сохраняется в стек истории
- Поддерживается отмена и повтор действий
- Количество сохраняемых состояний ограничено для экономии памяти

### Система слоев
Реализована с использованием QImage для каждого слоя:
- Слои композитируются в финальное изображение
- Поддерживается видимость слоев
- Возможно перемещение слоев

## Инструменты редактора

1. **Карандаш (Pen)** - рисование отдельных пикселей
2. **Ластик (Eraser)** - стирание пикселей (замена на белый цвет)
3. **Прямоугольник (Rectangle)** - рисование контура прямоугольника
4. **Выделение (Select)** - выделение области для дальнейших операций
5. **Заливка (Fill)** - заливка области одним цветом
6. **Пипетка (Eyedropper)** - выбор цвета с холста
7. **Линия (Line)** - рисование прямой линии
8. **Текст (Text)** - добавление текста на холст

### Трансформации выделенной области
- Отражение по горизонтали (Ctrl+H)
- Отражение по вертикали (Ctrl+Shift+V)
- Поворот на 90° по часовой стрелке (Ctrl+R)
- Поворот на 90° против часовой стрелки (Ctrl+Shift+R)
- Масштабирование (Ctrl+Shift+Plus/Minus)

## Горячие клавиши

### Файловые операции
- **Ctrl+N** - Новый файл
- **Ctrl+O** - Открыть
- **Ctrl+S** - Сохранить
- **Ctrl+Shift+S** - Сохранить как
- **Ctrl+E** - Экспорт

### Редактирование
- **Ctrl+Z** - Отменить
- **Ctrl+Shift+Z** - Повторить
- **Ctrl+X** - Вырезать
- **Ctrl+C** - Копировать
- **Ctrl+V** - Вставить
- **Delete** - Удалить выделение
- **Ctrl+A** - Выделить всё
- **Esc** - Сбросить выделение

### Навигация и вид
- **Ctrl+Plus** - Увеличить масштаб
- **Ctrl+Minus** - Уменьшить масштаб
- **Ctrl+G** - Показать/скрыть сетку
- **Ctrl+R** - Показать/скрыть линейки

### Перемещение выделения
- **Стрелки** - Перемещение на 1 пиксель
- **Shift+Стрелки** - Перемещение на 10 пикселей

### Работа со слоями
- **Ctrl+Up** - Переместить слой вверх
- **Ctrl+Down** - Переместить слой вниз

### Использование ластика
- **Правая кнопка мыши** - временный режим ластика
- **Alt (зажатие)** - временный режим ластика
- Выбор инструмента "Ластик" для постоянного режима 

## Последние улучшения

В последних версиях PixelCraftor были добавлены следующие улучшения:

### 1. Настраиваемая сетка
- Возможность изменять размер ячеек сетки
- Настройка цвета сетки
- Включение/выключение отображения сетки через меню или горячую клавишу Ctrl+G

### 2. Линейки и направляющие
- Линейки с делениями по краям холста
- Создание направляющих кликом на линейках
- Перетаскивание направляющих для точного позиционирования
- Удаление всех направляющих через меню или горячую клавишу Ctrl+Shift+G

### 3. Улучшенная работа с ластиком
- Три режима работы ластика:
  - Постоянный режим через выбор инструмента "Ластик"
  - Временный режим при нажатии правой кнопки мыши
  - Временный режим при зажатии клавиши Alt

### 4. Удобный выбор разрешения
- Виджет разрешения внизу холста
- Диалог с предустановленными вариантами разрешений
- Возможность задать произвольный размер холста

### 5. Расширенное меню трансформации
- Новое меню "Трансформация" с операциями для выделенной области
- Пункты для управления линейками и направляющими
- Горячие клавиши для всех основных операций трансформации

## Рекомендации по разработке

При разработке новых функций для PixelCraftor рекомендуется придерживаться следующих принципов:

### Соблюдение архитектуры
- Следуйте паттерну MVC
- Используйте сигналы и слоты для коммуникации между компонентами
- Разделяйте логику и представление

### Стиль кода
- Используйте PEP 8 для форматирования кода
- Добавляйте документацию к классам и методам
- Группируйте связанные методы и переменные

### Расширение функциональности
- Для добавления нового инструмента:
  1. Добавьте кнопку в `ToolPanel` в файле `tools.py`
  2. Реализуйте обработку инструмента в методах `mousePressEvent`, `mouseMoveEvent` и `mouseReleaseEvent` в `canvas.py`
  3. Добавьте иконку и описание инструмента

- Для добавления нового формата экспорта:
  1. Создайте новый конвертер или расширьте существующий
  2. Добавьте пункт меню в `main.py`
  3. Обновите документацию

### Тестирование
- Проверяйте новую функциональность на разных разрешениях холста
- Тестируйте взаимодействие с существующими инструментами
- Убедитесь, что история изменений работает корректно с новыми функциями

## Установка и запуск

### Требования
- Python 3.8 или выше
- PySide6
- Pillow (PIL)

### Установка зависимостей
```bash
pip install PySide6
pip install Pillow
```

### Запуск приложения
```bash
python main.py
```

### Сборка исполняемого файла
Для создания автономного исполняемого файла можно использовать PyInstaller:

```bash
pip install pyinstaller
pyinstaller --windowed --icon=PixelCraftor.ico --name=PixelCraftor main.py
```

## Планы развития

### Краткосрочные планы
1. Добавление инструмента "Эллипс" для рисования окружностей и овалов
2. Улучшение работы с текстом (выбор шрифта, размера, стиля)
3. Добавление палитры с сохранением пользовательских цветов
4. Реализация инструмента "Выделение по цвету"

### Среднесрочные планы
1. Добавление анимационных возможностей (кадры, таймлайн)
2. Поддержка плагинов для расширения функциональности
3. Экспорт в форматы для различных микроконтроллеров и дисплеев
4. Улучшение системы слоев (маски, режимы наложения)

### Долгосрочные планы
1. Создание онлайн-версии с возможностью совместного редактирования
2. Интеграция с библиотеками готовых спрайтов и тайлсетов
3. Поддержка создания тайловых карт для игр
4. Инструменты для создания пиксельной анимации с возможностью предпросмотра 
